'use strict';

const path = require('path');

module.exports = Franz => {
  const getMessages = () => {
    const updates = parseInt(document.querySelector('i#sr-last-counter').textContent, 10);
    let messages = 0;

    const conversations = document.querySelectorAll('.chat-counter:not(.d-none)').length;
    if (conversations === 0) {
      messages = 0;
    } else {
      for (let i = 0; i < conversations; i + 1) {
        messages += parseInt(document.querySelectorAll('.chat-counter:not(.d-none)')[i].textContent, 10);
      }
    }

    Franz.setBadge(messages, updates);
  };

  Franz.injectCSS(path.join(__dirname, 'service.css'));
  Franz.loop(getMessages);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdhZHVnYWR1L3dlYnZpZXcuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJtb2R1bGUiLCJleHBvcnRzIiwiRnJhbnoiLCJnZXRNZXNzYWdlcyIsInVwZGF0ZXMiLCJwYXJzZUludCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInRleHRDb250ZW50IiwibWVzc2FnZXMiLCJjb252ZXJzYXRpb25zIiwicXVlcnlTZWxlY3RvckFsbCIsImxlbmd0aCIsImkiLCJzZXRCYWRnZSIsImluamVjdENTUyIsImpvaW4iLCJfX2Rpcm5hbWUiLCJsb29wIl0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLE9BQU9DLFFBQVEsTUFBUixDQUFiOztBQUVBQyxPQUFPQyxPQUFQLEdBQWtCQyxLQUFELElBQVc7QUFDMUIsUUFBTUMsY0FBYyxNQUFNO0FBQ3hCLFVBQU1DLFVBQVVDLFNBQVNDLFNBQVNDLGFBQVQsQ0FBdUIsbUJBQXZCLEVBQTRDQyxXQUFyRCxFQUFrRSxFQUFsRSxDQUFoQjtBQUNBLFFBQUlDLFdBQVcsQ0FBZjs7QUFFQSxVQUFNQyxnQkFBZ0JKLFNBQVNLLGdCQUFULENBQTBCLDRCQUExQixFQUF3REMsTUFBOUU7QUFDQSxRQUFJRixrQkFBa0IsQ0FBdEIsRUFBeUI7QUFDdkJELGlCQUFXLENBQVg7QUFDRCxLQUZELE1BRU87QUFDTCxXQUFLLElBQUlJLElBQUksQ0FBYixFQUFnQkEsSUFBSUgsYUFBcEIsRUFBbUNHLElBQUksQ0FBdkMsRUFBMEM7QUFDeENKLG9CQUFZSixTQUFTQyxTQUFTSyxnQkFBVCxDQUEwQiw0QkFBMUIsRUFBd0RFLENBQXhELEVBQTJETCxXQUFwRSxFQUFpRixFQUFqRixDQUFaO0FBQ0Q7QUFDRjs7QUFFRE4sVUFBTVksUUFBTixDQUFlTCxRQUFmLEVBQXlCTCxPQUF6QjtBQUNELEdBZEQ7O0FBZ0JBRixRQUFNYSxTQUFOLENBQWdCakIsS0FBS2tCLElBQUwsQ0FBVUMsU0FBVixFQUFxQixhQUFyQixDQUFoQjtBQUNBZixRQUFNZ0IsSUFBTixDQUFXZixXQUFYO0FBQ0QsQ0FuQkQiLCJmaWxlIjoiZ2FkdWdhZHUvd2Vidmlldy5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gKEZyYW56KSA9PiB7XG4gIGNvbnN0IGdldE1lc3NhZ2VzID0gKCkgPT4ge1xuICAgIGNvbnN0IHVwZGF0ZXMgPSBwYXJzZUludChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpI3NyLWxhc3QtY291bnRlcicpLnRleHRDb250ZW50LCAxMCk7XG4gICAgbGV0IG1lc3NhZ2VzID0gMDtcblxuICAgIGNvbnN0IGNvbnZlcnNhdGlvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2hhdC1jb3VudGVyOm5vdCguZC1ub25lKScpLmxlbmd0aDtcbiAgICBpZiAoY29udmVyc2F0aW9ucyA9PT0gMCkge1xuICAgICAgbWVzc2FnZXMgPSAwO1xuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbnZlcnNhdGlvbnM7IGkgKyAxKSB7XG4gICAgICAgIG1lc3NhZ2VzICs9IHBhcnNlSW50KGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jaGF0LWNvdW50ZXI6bm90KC5kLW5vbmUpJylbaV0udGV4dENvbnRlbnQsIDEwKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBGcmFuei5zZXRCYWRnZShtZXNzYWdlcywgdXBkYXRlcyk7XG4gIH07XG5cbiAgRnJhbnouaW5qZWN0Q1NTKHBhdGguam9pbihfX2Rpcm5hbWUsICdzZXJ2aWNlLmNzcycpKTtcbiAgRnJhbnoubG9vcChnZXRNZXNzYWdlcyk7XG59O1xuIl19