'use strict';

const path = require('path');

module.exports = (Franz, options) => {
  function getMessages() {
    let directCount = 0;
    let indirectCount = 0;
    let chat_item = document.querySelectorAll('div.chat_item');

    Array.prototype.forEach.call(chat_item, function (item) {
      let count = 0;
      let reddot = item.querySelector("i.web_wechat_reddot_middle");
      let avatarImage = item.querySelector("img.img");

      if (reddot && reddot.innerText) {
        count = parseInt(reddot.innerText);
      }

      if (avatarImage && avatarImage.getAttribute("src").search("webwxgeticon") != -1) {
        directCount += count;
      } else {
        indirectCount += count;
      }
    });

    Franz.setBadge(directCount, indirectCount);
  }

  Franz.injectCSS(path.join(__dirname, 'service.css'));

  Franz.loop(getMessages);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlY2hhdC93ZWJ2aWV3LmpzIl0sIm5hbWVzIjpbInBhdGgiLCJyZXF1aXJlIiwibW9kdWxlIiwiZXhwb3J0cyIsIkZyYW56Iiwib3B0aW9ucyIsImdldE1lc3NhZ2VzIiwiZGlyZWN0Q291bnQiLCJpbmRpcmVjdENvdW50IiwiY2hhdF9pdGVtIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJmb3JFYWNoIiwiY2FsbCIsIml0ZW0iLCJjb3VudCIsInJlZGRvdCIsInF1ZXJ5U2VsZWN0b3IiLCJhdmF0YXJJbWFnZSIsImlubmVyVGV4dCIsInBhcnNlSW50IiwiZ2V0QXR0cmlidXRlIiwic2VhcmNoIiwic2V0QmFkZ2UiLCJpbmplY3RDU1MiLCJqb2luIiwiX19kaXJuYW1lIiwibG9vcCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0EsTUFBTUEsT0FBT0MsUUFBUSxNQUFSLENBQWI7O0FBRUFDLE9BQU9DLE9BQVAsR0FBaUIsQ0FBQ0MsS0FBRCxFQUFRQyxPQUFSLEtBQW9CO0FBQ25DLFdBQVNDLFdBQVQsR0FBdUI7QUFDckIsUUFBSUMsY0FBYyxDQUFsQjtBQUNBLFFBQUlDLGdCQUFnQixDQUFwQjtBQUNBLFFBQUlDLFlBQVlDLFNBQVNDLGdCQUFULENBQTBCLGVBQTFCLENBQWhCOztBQUVBQyxVQUFNQyxTQUFOLENBQWdCQyxPQUFoQixDQUF3QkMsSUFBeEIsQ0FBNkJOLFNBQTdCLEVBQXdDLFVBQVVPLElBQVYsRUFBZ0I7QUFDdEQsVUFBSUMsUUFBUSxDQUFaO0FBQ0EsVUFBSUMsU0FBU0YsS0FBS0csYUFBTCxDQUFtQiw0QkFBbkIsQ0FBYjtBQUNBLFVBQUlDLGNBQWNKLEtBQUtHLGFBQUwsQ0FBbUIsU0FBbkIsQ0FBbEI7O0FBRUEsVUFBSUQsVUFBVUEsT0FBT0csU0FBckIsRUFBZ0M7QUFDOUJKLGdCQUFRSyxTQUFTSixPQUFPRyxTQUFoQixDQUFSO0FBQ0Q7O0FBRUQsVUFBSUQsZUFBZUEsWUFBWUcsWUFBWixDQUF5QixLQUF6QixFQUFnQ0MsTUFBaEMsQ0FBdUMsY0FBdkMsS0FBMEQsQ0FBQyxDQUE5RSxFQUFpRjtBQUMvRWpCLHVCQUFlVSxLQUFmO0FBQ0QsT0FGRCxNQUVPO0FBQ0xULHlCQUFpQlMsS0FBakI7QUFDRDtBQUNGLEtBZEQ7O0FBZ0JBYixVQUFNcUIsUUFBTixDQUFlbEIsV0FBZixFQUE0QkMsYUFBNUI7QUFDRDs7QUFFREosUUFBTXNCLFNBQU4sQ0FBZ0IxQixLQUFLMkIsSUFBTCxDQUFVQyxTQUFWLEVBQXFCLGFBQXJCLENBQWhCOztBQUVBeEIsUUFBTXlCLElBQU4sQ0FBV3ZCLFdBQVg7QUFDRCxDQTVCRCIsImZpbGUiOiJ3ZWNoYXQvd2Vidmlldy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gKEZyYW56LCBvcHRpb25zKSA9PiB7XG4gIGZ1bmN0aW9uIGdldE1lc3NhZ2VzKCkge1xuICAgIGxldCBkaXJlY3RDb3VudCA9IDA7XG4gICAgbGV0IGluZGlyZWN0Q291bnQgPSAwO1xuICAgIGxldCBjaGF0X2l0ZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdkaXYuY2hhdF9pdGVtJyk7XG5cbiAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGNoYXRfaXRlbSwgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICBsZXQgcmVkZG90ID0gaXRlbS5xdWVyeVNlbGVjdG9yKFwiaS53ZWJfd2VjaGF0X3JlZGRvdF9taWRkbGVcIik7XG4gICAgICBsZXQgYXZhdGFySW1hZ2UgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoXCJpbWcuaW1nXCIpO1xuXG4gICAgICBpZiAocmVkZG90ICYmIHJlZGRvdC5pbm5lclRleHQpIHtcbiAgICAgICAgY291bnQgPSBwYXJzZUludChyZWRkb3QuaW5uZXJUZXh0KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGF2YXRhckltYWdlICYmIGF2YXRhckltYWdlLmdldEF0dHJpYnV0ZShcInNyY1wiKS5zZWFyY2goXCJ3ZWJ3eGdldGljb25cIikgIT0gLTEpIHtcbiAgICAgICAgZGlyZWN0Q291bnQgKz0gY291bnQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpbmRpcmVjdENvdW50ICs9IGNvdW50O1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgRnJhbnouc2V0QmFkZ2UoZGlyZWN0Q291bnQsIGluZGlyZWN0Q291bnQpO1xuICB9XG5cbiAgRnJhbnouaW5qZWN0Q1NTKHBhdGguam9pbihfX2Rpcm5hbWUsICdzZXJ2aWNlLmNzcycpKTtcblxuICBGcmFuei5sb29wKGdldE1lc3NhZ2VzKTtcbn1cbiJdfQ==